{{/* 
  Trim and clean up a "map-like" text (e.g. Hugo map[...] syntax),
  turning it into valid JSON so it can be unmarshaled into a real map.
*/}}

{{/* 1. Remove leading/trailing whitespace */}}
{{ $file := . | strings.TrimSpace }}

{{/* 2. Escape specific HTML characters */}}
{{ $file = replace $file `"[\*]"` `` }}

{{/* 3. Replace single quotes with double quotes (JSON requires double quotes) */}}
{{ $file = replace $file `'` `"` }}

{{/* 4. Wrap bare keys with double quotes */}}
{{ $file = replaceRE `(?m)(^|,|\{)\s*([A-Za-z_][A-Za-z0-9_]*)\s*:` `${1}"${2}":` $file }}

{{/* 5. Wrap unquoted text values with double quotes */}}
{{ $file = replaceRE `(?m):\s*([A-Za-z_][A-Za-z0-9_]*)\s*(,|$|\})` `:"${1}"$2` $file }}

{/* 6. Remove trailing commas before closing braces/brackets */}}
{{ $file = replaceRE `,\s*([}\]])` `$1` $file }}

{{/* 7. Remove a final trailing comma at the end of the file, if any */}}
{{ $file = replaceRE `,\s*$` `` $file }}

{{/* 8. Convert the cleaned JSON string into a Hugo map/object */}}
{{ return ($file | transform.Unmarshal) }}
