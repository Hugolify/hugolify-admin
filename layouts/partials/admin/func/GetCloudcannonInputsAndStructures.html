{{ $inputsFields := slice }}
{{ $structuresFields := slice }}

{{/* Get array fields from enable blocks */}}
{{ $blocks := site.Params.admin.blocks.enable }}
{{ range $blocks }}
  {{ $fields := print "admin/blocks/fields/" . ".html" }}
  {{ if templates.Exists (printf "partials/%s" $fields) }}
    {{ $fields = partialCached $fields . }}
    
    {{/* Check all fields from this block */}}
    {{ range $fields }}
      {{ $field := print "admin/fields/" . ".yml" }}
      {{ if templates.Exists (printf "partials/%s" $field) }}
        {{ $file := partial $field }}
        {{ $datas := partial "func/ConvertJSObjectToJson.html" (htmlUnescape $file) }}
        {{ range $datas }}
          {{ $datas = . }}
        {{ end }}

        {{/* Get type of field */}}
        {{ $type := $datas.type }}
        
        {{/* Conditional switch */}}
        {{ if or (eq $type "object") (eq $type "array") }}
          {{/* Add field to structures */}}
          {{ $structuresFields = $structuresFields | append . }}
          
          {{/* Process all subfields from this field */}}
          {{ range $datas.fields }}
            {{ $subField := print "admin/fields/" . ".yml" }}
            {{ if templates.Exists (printf "partials/%s" $subField) }}
              {{ $subFile := partial $subField }}
              {{ $subDatas := partial "func/ConvertJSObjectToJson.html" (htmlUnescape $subFile) }}
              {{ range $subDatas }}
              {{ $subDatas = . }}
              {{ end }}
              
              {{/* Get type of field */}}
              {{ $subType := $subDatas.type }}
              
              {{ if or (eq $subType "object") (eq $subType "array") }}
                {{ $structuresFields = $structuresFields | append . }}
              {{ else }}
                {{ $inputsFields = $inputsFields | append . }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ else }}
          {{/* Add field to inputs */}}
          {{ $inputsFields = $inputsFields | append . }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{/* Remove duplicates */}}
{{ $inputsFields = $inputsFields | uniq }}
{{ $structuresFields = $structuresFields | uniq }}

{{ return (dict "inputs" $inputsFields "structures" $structuresFields) }}