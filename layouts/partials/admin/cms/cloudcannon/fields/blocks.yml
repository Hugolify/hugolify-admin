{{- $blocks := site.Params.admin.blocks.enable -}}

{{ with $blocks }}
  blocks:
    style: modal
    values:
    {{- range . }}
      
      {{/* Get block fields file */}}
      {{- $block_key := . -}}
      {{- $block_name := i18n (print "admin.blocks." . ".label") | default (. | humanize) -}}
      {{- $block_hint := i18n (print "admin.blocks." . ".hint") | default false -}}
      {{- $block_icon := (index site.Params.admin.blocks .).icon.cloudcannon | default false -}}
      {{- $fields := print "admin/blocks/fields/" . ".yml" -}}
      {{- if templates.Exists ( printf "partials/%s" $fields ) -}}
        {{- $fields = partialCached $fields . -}}
      {{- end -}}

      - value:
          _type: {{ $block_name }}
          {{- range $fields }}
          {{ . }}:
          {{- end }}
        preview:
          text:
            - key: {{ $block_key }}
            - {{ $block_name }}
          {{- with $block_hint }}
          subtext:
            - key: {{ $block_key }}_description
            - {{ . }}
          {{- end }}
          {{- with $block_icon }}
          icon: {{ . }}
          {{- end }}
      
    {{- end }}
{{- end }}